/*! 
 Build based on gin-vue-admin 
 Time : 1717039643000 */
import{K as e,r as a,a as l,M as t,o,c as s,b as r,d as u,w as n,i,e as d,t as m,D as p,F as c,m as v,g as f,P as b,E as g,j as y,k as B,q as E}from"./087AC4D233B64EB0index.39f1eb31.js";import{E as C}from"./087AC4D233B64EB0drawer.ae3d541f.js";import"./087AC4D233B64EB0overlay.3905897c.js";import{E as h}from"./087AC4D233B64EB0input-number.c9c9df06.js";/* empty css                              */import"./087AC4D233B64EB0tag.d3c1c3e4.js";import{E as D,a as A}from"./087AC4D233B64EB0select.7f5b5538.js";import"./087AC4D233B64EB0scrollbar.3894915f.js";/* empty css                               *//* empty css                                */import{E as V}from"./087AC4D233B64EB0pagination.ce43b352.js";import{E as _,a as w}from"./087AC4D233B64EB0table-column.e9b4a870.js";import"./087AC4D233B64EB0checkbox.a3853383.js";import{a as j,E as x}from"./087AC4D233B64EB0form-item.a86c41d2.js";/* empty css                               */import{f as I}from"./087AC4D233B64EB0format.9823c1e6.js";import{g as T}from"./087AC4D233B64EB0autoCode.2e981990.js";import{E as k}from"./087AC4D233B64EB0index.d8bfc0de.js";import"./087AC4D233B64EB0isUndefined.d281c39a.js";import"./087AC4D233B64EB0_Uint8Array.02b83471.js";import"./087AC4D233B64EB0isEqual.e024b3a6.js";import"./087AC4D233B64EB0hasIn.9f12b2a1.js";import"./087AC4D233B64EB0index.5d58b83c.js";import"./087AC4D233B64EB0strings.2df7e9e1.js";import"./087AC4D233B64EB0debounce.0aab18a9.js";import"./087AC4D233B64EB0_initCloneObject.0c0ca3ea.js";import"./087AC4D233B64EB0castArray.209ac14b.js";import"./087AC4D233B64EB0_baseClone.a73122b0.js";import"./087AC4D233B64EB0date.225eaf4f.js";import"./087AC4D233B64EB0dictionary.2d6433e1.js";import"./087AC4D233B64EB0sysDictionary.e0472ec6.js";const N=a=>e({url:"/sysExportTemplate/createSysExportTemplate",method:"post",data:a}),z={class:"gva-search-box"},U={class:"gva-table-box"},S={class:"gva-btn-list"},q={class:"gva-pagination"},O={class:"flex items-center justify-between"},L={class:"text-lg"},F={style:{float:"right",color:"#8492a6","font-size":"13px"}},K={class:"flex justify-end w-full"},W=Object.assign({name:"ExportTemplate"},{__name:"exportTemplate",setup(W){const J=a({name:"",tableName:"",templateID:"",templateInfo:"",limit:0,order:"",conditions:[]}),R=a([{label:"=",value:"="},{label:"<>",value:"<>"},{label:">",value:">"},{label:"<",value:"<"},{label:"LIKE",value:"LIKE"},{label:"BETWEEN",value:"BETWEEN"},{label:"NOT BETWEEN",value:"NOT BETWEEN"}]),G=()=>{J.value.conditions.push({from:"",column:"",operator:""})},M=l({name:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],tableName:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],templateID:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}],templateInfo:[{required:!0,message:"",trigger:["input","blur"]},{whitespace:!0,message:"不能只输入空格",trigger:["input","blur"]}]}),P=l({createdAt:[{validator:(e,a,l)=>{ee.value.startCreatedAt&&!ee.value.endCreatedAt?l(new Error("请填写结束日期")):!ee.value.startCreatedAt&&ee.value.endCreatedAt?l(new Error("请填写开始日期")):ee.value.startCreatedAt&&ee.value.endCreatedAt&&(ee.value.startCreatedAt.getTime()===ee.value.endCreatedAt.getTime()||ee.value.startCreatedAt.getTime()>ee.value.endCreatedAt.getTime())?l(new Error("开始日期应当早于结束日期")):l()},trigger:"change"}]}),Q=a(),$=a(),H=a(1),X=a(0),Y=a(10),Z=a([]),ee=a({}),ae=a([]);(async()=>{const e=await T();0===e.code&&(ae.value=e.data.dbList)})();const le=()=>{ee.value={},re()},te=()=>{var e;null==(e=$.value)||e.validate((async e=>{e&&(H.value=1,Y.value=10,re())}))},oe=e=>{Y.value=e,re()},se=e=>{H.value=e,re()},re=async()=>{const a=await(l={page:H.value,pageSize:Y.value,...ee.value},e({url:"/sysExportTemplate/getSysExportTemplateList",method:"get",params:l}));var l;0===a.code&&(Z.value=a.data.list,X.value=a.data.total,H.value=a.data.page,Y.value=a.data.pageSize)};re();(async()=>{})();const ue=a([]),ne=e=>{ue.value=e},ie=async()=>{b.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const a=[];if(0===ue.value.length)return void g({type:"warning",message:"请选择要删除的数据"});ue.value&&ue.value.map((e=>{a.push(e.ID)}));var l;0===(await(l={ids:a},e({url:"/sysExportTemplate/deleteSysExportTemplateByIds",method:"delete",data:l}))).code&&(g({type:"success",message:"删除成功"}),Z.value.length===a.length&&H.value>1&&H.value--,re())}))},de=a(""),me=async a=>{const l=await(t={ID:a.ID},e({url:"/sysExportTemplate/findSysExportTemplate",method:"get",params:t}));var t;de.value="update",0===l.code&&(J.value=l.data.resysExportTemplate,J.value.conditions||(J.value.conditions=[]),ce.value=!0)},pe=async a=>{var l;0===(await(l={ID:a.ID},e({url:"/sysExportTemplate/deleteSysExportTemplate",method:"delete",data:l}))).code&&(g({type:"success",message:"删除成功"}),1===Z.value.length&&H.value>1&&H.value--,re())},ce=a(!1),ve=()=>{de.value="create",ce.value=!0},fe=()=>{ce.value=!1,J.value={name:"",tableName:"",templateID:"",templateInfo:"",limit:0,order:"",conditions:[]}},be=async()=>{var a;try{JSON.parse(J.value.templateInfo)}catch(t){return void g({type:"error",message:"模板信息格式不正确，请检查"})}const l=JSON.parse(JSON.stringify(J.value));for(let e=0;e<l.conditions.length;e++){if(!l.conditions[e].from||!l.conditions[e].column||!l.conditions[e].operator)return void g({type:"error",message:"请填写完整的导出条件"});l.conditions[e].templateID=l.templateID}null==(a=Q.value)||a.validate((async a=>{if(!a)return;let t;switch(de.value){case"create":default:t=await N(l);break;case"update":t=await(o=l,e({url:"/sysExportTemplate/updateSysExportTemplate",method:"put",data:o}))}var o;0===t.code&&(g({type:"success",message:"创建/更改成功"}),fe(),re())}))};return(e,a)=>{const l=y,g=j,T=B,N=x,W=_,re=w,ge=V,ye=t("QuestionFilled"),Be=E,Ee=k,Ce=D,he=A,De=h,Ae=C;return o(),s("div",null,[r("div",z,[u(N,{ref_key:"elSearchFormRef",ref:$,inline:!0,model:ee.value,class:"demo-form-inline",rules:P,onKeyup:d(te,["enter"])},{default:n((()=>[u(g,{label:"模板名称",prop:"name"},{default:n((()=>[u(l,{modelValue:ee.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>ee.value.name=e),size:"small",class:"w-28",placeholder:""},null,8,["modelValue"])])),_:1}),u(g,{label:"表名称",prop:"tableName"},{default:n((()=>[u(l,{modelValue:ee.value.tableName,"onUpdate:modelValue":a[1]||(a[1]=e=>ee.value.tableName=e),size:"small",class:"w-28",placeholder:""},null,8,["modelValue"])])),_:1}),u(g,{label:"模板标识",prop:"templateID"},{default:n((()=>[u(l,{modelValue:ee.value.templateID,"onUpdate:modelValue":a[2]||(a[2]=e=>ee.value.templateID=e),size:"small",class:"w-28",placeholder:""},null,8,["modelValue"])])),_:1}),u(g,null,{default:n((()=>[u(T,{type:"primary",icon:"search",size:"small",onClick:te},{default:n((()=>[i("查询")])),_:1}),u(T,{icon:"refresh",size:"small",onClick:le},{default:n((()=>[i("重置")])),_:1})])),_:1})])),_:1},8,["model","rules"])]),r("div",U,[r("div",S,[u(T,{type:"primary",icon:"plus",size:"small",onClick:ve},{default:n((()=>[i("新增")])),_:1}),u(T,{icon:"delete",size:"small",style:{"margin-left":"10px"},disabled:!ue.value.length,onClick:ie},{default:n((()=>[i("删除")])),_:1},8,["disabled"])]),u(re,{ref:"multipleTable",style:{width:"100%"},"tooltip-effect":"dark",data:Z.value,"row-key":"ID",onSelectionChange:ne},{default:n((()=>[u(W,{type:"selection",width:"55"}),u(W,{align:"left",label:"日期",width:"180"},{default:n((e=>[i(m(p(I)(e.row.CreatedAt)),1)])),_:1}),u(W,{align:"left",label:"数据库",prop:"name",width:"120"},{defalut:n((e=>[r("span",null,m(e.row.dbNname||"GVA库"),1)])),_:1}),u(W,{align:"left",label:"模板名称",prop:"name",width:"120"}),u(W,{align:"left",label:"表名称",prop:"tableName",width:"120"}),u(W,{align:"left",label:"模板标识",prop:"templateID",width:"120"}),u(W,{align:"left",label:"模板信息",prop:"templateInfo","min-width":"120"}),u(W,{align:"left",label:"操作","min-width":"120"},{default:n((e=>[u(T,{type:"primary",link:"",icon:"edit",size:"small",class:"table-button",onClick:a=>me(e.row)},{default:n((()=>[i("变更")])),_:2},1032,["onClick"]),u(T,{type:"primary",link:"",icon:"delete",size:"small",onClick:a=>{return l=e.row,void b.confirm("确定要删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{pe(l)}));var l}},{default:n((()=>[i("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),r("div",q,[u(ge,{layout:"total, sizes, prev, pager, next","current-page":H.value,"page-size":Y.value,"page-sizes":[10,30,50,100],total:X.value,small:"",onCurrentChange:se,onSizeChange:oe},null,8,["current-page","page-size","total"])])]),u(Ae,{modelValue:ce.value,"onUpdate:modelValue":a[10]||(a[10]=e=>ce.value=e),size:"60%","before-close":fe,title:"create"===de.value?"添加":"修改","show-close":!1,"destroy-on-close":""},{header:n((()=>[r("div",O,[r("span",L,m("create"===de.value?"添加":"修改"),1),r("div",null,[u(T,{size:"small",onClick:fe},{default:n((()=>[i("取 消")])),_:1}),u(T,{size:"small",type:"primary",onClick:be},{default:n((()=>[i("确 定")])),_:1})])])])),default:n((()=>[u(N,{ref_key:"elFormRef",ref:Q,model:J.value,"label-position":"right",rules:M,"label-width":"100px"},{default:n((()=>[u(g,{label:"业务库",prop:"dbName"},{label:n((()=>[u(Ee,{content:"注：需要提前到db-list自行配置多数据库，如未配置需配置后重启服务方可使用。若无法选择，请到config.yaml中设置disabled:false，选择导入导出的目标库。",placement:"bottom",effect:"light"},{default:n((()=>[r("div",null,[i(" 业务库 "),u(Be,null,{default:n((()=>[u(ye)])),_:1})])])),_:1})])),default:n((()=>[u(he,{modelValue:J.value.dbName,"onUpdate:modelValue":a[3]||(a[3]=e=>J.value.dbName=e),clearable:"",placeholder:"选择业务库"},{default:n((()=>[(o(!0),s(c,null,v(ae.value,(e=>(o(),f(Ce,{key:e.aliasName,value:e.aliasName,label:e.aliasName,disabled:e.disable},{default:n((()=>[r("div",null,[r("span",null,m(e.aliasName),1),r("span",F,m(e.dbName),1)])])),_:2},1032,["value","label","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1}),u(g,{label:"模板名称:",prop:"name"},{default:n((()=>[u(l,{modelValue:J.value.name,"onUpdate:modelValue":a[4]||(a[4]=e=>J.value.name=e),clearable:!0,placeholder:"请输入模板名称"},null,8,["modelValue"])])),_:1}),u(g,{label:"表名称:",prop:"tableName"},{default:n((()=>[u(l,{modelValue:J.value.tableName,"onUpdate:modelValue":a[5]||(a[5]=e=>J.value.tableName=e),clearable:!0,placeholder:"请输入要导出的表名称"},null,8,["modelValue"])])),_:1}),u(g,{label:"模板标识:",prop:"templateID"},{default:n((()=>[u(l,{modelValue:J.value.templateID,"onUpdate:modelValue":a[6]||(a[6]=e=>J.value.templateID=e),clearable:!0,placeholder:"模板标识为前端组件需要挂在的标识属性"},null,8,["modelValue"])])),_:1}),u(g,{label:"模板信息:",prop:"templateInfo"},{default:n((()=>[u(l,{modelValue:J.value.templateInfo,"onUpdate:modelValue":a[7]||(a[7]=e=>J.value.templateInfo=e),type:"textarea",rows:12,clearable:!0,placeholder:'模板信息格式：key标识数据库column列名称，value标识导出excel列名称，如下：\n{\n  "table_name1":"第一列",\n  "table_name2":"第二列",\n  "table_name3":"第三列",\n  "table_name4":"第四列",\n}\n'},null,8,["modelValue"])])),_:1}),u(g,{label:"默认导出条数:"},{default:n((()=>[u(De,{modelValue:J.value.limit,"onUpdate:modelValue":a[8]||(a[8]=e=>J.value.limit=e),step:1,"step-strictly":!0,precision:0},null,8,["modelValue"])])),_:1}),u(g,{label:"默认排序条件:"},{default:n((()=>[u(l,{modelValue:J.value.order,"onUpdate:modelValue":a[9]||(a[9]=e=>J.value.order=e),placeholder:"例:id desc"},null,8,["modelValue"])])),_:1}),u(g,{label:"导出条件:"},{default:n((()=>[(o(!0),s(c,null,v(J.value.conditions,((e,a)=>(o(),s("div",{key:a,class:"flex w-full gap-4 mb-2"},[u(l,{modelValue:e.from,"onUpdate:modelValue":a=>e.from=a,placeholder:"需要从查询条件取的json key"},null,8,["modelValue","onUpdate:modelValue"]),u(l,{modelValue:e.column,"onUpdate:modelValue":a=>e.column=a,placeholder:"表对应的column"},null,8,["modelValue","onUpdate:modelValue"]),u(he,{modelValue:e.operator,"onUpdate:modelValue":a=>e.operator=a,placeholder:"请选择查询条件"},{default:n((()=>[(o(!0),s(c,null,v(R.value,(e=>(o(),f(Ce,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),u(T,{type:"danger",icon:"delete",size:"small",onClick:()=>J.value.conditions.splice(a,1)},{default:n((()=>[i("删除")])),_:2},1032,["onClick"])])))),128)),r("div",K,[u(T,{type:"primary",icon:"plus",size:"small",onClick:G},{default:n((()=>[i("添加条件")])),_:1})])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}});export{W as default};
