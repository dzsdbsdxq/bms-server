/*! 
 Build based on gin-vue-admin 
 Time : 1717039643000 */
import{K as e,r as t,o as s,c as o,d as a,w as i,i as n,t as l,E as r,k as d}from"./087AC4D233B64EB0index.39f1eb31.js";import{E as h}from"./087AC4D233B64EB0upload.099811f5.js";import"./087AC4D233B64EB0progress.65ec04e5.js";/* empty css                               */const c=t=>e({url:"/fileUploadAndDownload/getFileList",method:"post",data:t}),p=t=>e({url:"/fileUploadAndDownload/deleteFile",method:"post",data:t}),m=t=>e({url:"/fileUploadAndDownload/editFileName",method:"post",data:t});class g{constructor(e,t,s=1920){this.file=e,this.fileSize=t,this.maxWH=s}compress(){const e=this.file.type,t=this.file.size/1024;return new Promise((s=>{const o=new FileReader;o.readAsDataURL(this.file),o.onload=()=>{const a=document.createElement("canvas"),i=document.createElement("img");i.src=o.result,i.onload=()=>{const o=a.getContext("2d"),n=this.dWH(i.width,i.height,this.maxWH);a.width=n.width,a.height=n.height,o.clearRect(0,0,a.width,a.height),o.drawImage(i,0,0,a.width,a.height);const l=a.toDataURL(e,.9),r=this.fileSizeKB(l);r>this.fileSize&&console.log("图片尺寸太大!"+t+" >> "+r);const d=this.dataURLtoBlob(l,e),h=new File([d],this.file.name);s(h)}}}))}dWH(e,t,s){const o={width:e,height:t};return Math.max(e,t)>s?e>t?(o.width=s,o.height=Math.round(t*(s/e)),o):(o.height=s,o.width=Math.round(e*(s/t)),o):o}fileSizeKB(e){let t=0;return t=Math.round(3*e.split(",")[1].length/4/1024),t}dataURLtoBlob(e,t){const s=atob(e.split(",")[1]);let o=e.split(",")[0].split(":")[1].split(";")[0];const a=new ArrayBuffer(s.length),i=new Uint8Array(a);for(let n=0;n<s.length;n++)i[n]=s.charCodeAt(n);return t&&(o=t),new Blob([a],{type:o,lastModifiedDate:new Date})}}const u=e=>e&&"http"!==e.slice(0,4)?"https://www.sztv.com.cn/ysztv/web//"+e:e,w=e=>e.endsWith(".mp4")||e.endsWith(".mov")||e.endsWith(".webm")||e.endsWith(".ogg"),f=Object.assign({name:"UploadCommon"},{__name:"common",props:{textTag:{type:String,default:"腾讯COS上传"},btnType:{type:String,default:"primary"},engine:{type:String,default:""}},emits:["on-success"],setup(e,{emit:c}){const p=c,m=t("https://www.sztv.com.cn/ysztv/web/"),g=t(!1),u=e=>{g.value=!0;const t=e.size/1024/1024<15,s=e.size/1024/1024<15,o="video/mp4"===(a=e.type)||"video/webm"===a||"video/ogg"===a;var a;const i=(e=>"image/jpeg"===e||"image/png"===e||"image/webp"===e||"image/svg+xml"===e)(e.type);let n=!0;return o||i||(r.error("上传图片只能是 jpg,png,svg,webp 格式, 上传视频只能是 mp4,webm 格式!"),g.value=!1,n=!1),!s&&o&&(r.error("上传视频大小不能超过 15MB"),g.value=!1,n=!1),!t&&i&&(r.error("未压缩的上传图片大小不能超过 500KB，请使用压缩上传"),g.value=!1,n=!1),console.log("upload file check result: ",n),n},w=e=>{const{data:t}=e;t.file&&p("on-success",t.file.url)},f=()=>{r({type:"error",message:"上传失败"}),g.value=!1};return(t,r)=>{const c=d,p=h;return s(),o("div",null,[a(p,{action:"".concat(m.value,"/fileUploadAndDownload/upload?engine=").concat(e.engine),"before-upload":u,"on-error":f,"on-success":w,"show-file-list":!1,class:"upload-btn"},{default:i((()=>[a(c,{size:"small",type:e.btnType},{default:i((()=>[n(l(e.textTag),1)])),_:1},8,["type"])])),_:1},8,["action"])])}}});export{g as I,f as _,u as a,p as d,m as e,c as g,w as i};
