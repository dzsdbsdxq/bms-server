/*! 
 Build based on gin-vue-admin 
 Time : 1717039643000 */
import{r as a,o as e,c as t,b as l,d as o,w as r,i,g as u,h as s,P as d,E as n,k as m,j as p}from"./087AC4D233B64EB0index.39f1eb31.js";import{E as y}from"./087AC4D233B64EB0drawer.ae3d541f.js";import"./087AC4D233B64EB0overlay.3905897c.js";import{E as h,a as v}from"./087AC4D233B64EB0tab-pane.9c69bef9.js";import{E as c}from"./087AC4D233B64EB0dialog.c75a9340.js";import{a as B,E as f}from"./087AC4D233B64EB0form-item.a86c41d2.js";/* empty css                              */import{E as C}from"./087AC4D233B64EB0radio.6c10d629.js";/* empty css                               */import"./087AC4D233B64EB0tag.d3c1c3e4.js";import"./087AC4D233B64EB0checkbox.a3853383.js";import"./087AC4D233B64EB0scrollbar.3894915f.js";import{E as I,a as E}from"./087AC4D233B64EB0table-column.e9b4a870.js";/* empty css                                *//* empty css                               */import{g as A,d as b,c as g,u as D,a as j}from"./087AC4D233B64EB0authority.e5789bef.js";import w from"./087AC4D233B64EB0menus.bcbe0423.js";import k from"./087AC4D233B64EB0apis.5edbfd89.js";import _ from"./087AC4D233B64EB0datas.913df540.js";import"./087AC4D233B64EB0isUndefined.d281c39a.js";import"./087AC4D233B64EB0strings.2df7e9e1.js";import"./087AC4D233B64EB0castArray.209ac14b.js";import"./087AC4D233B64EB0_baseClone.a73122b0.js";import"./087AC4D233B64EB0_Uint8Array.02b83471.js";import"./087AC4D233B64EB0_initCloneObject.0c0ca3ea.js";import"./087AC4D233B64EB0index.8fd65b4f.js";import"./087AC4D233B64EB0isEqual.e024b3a6.js";import"./087AC4D233B64EB0cloneDeep.5b0b6a51.js";import"./087AC4D233B64EB0index.d8bfc0de.js";import"./087AC4D233B64EB0index.5d58b83c.js";import"./087AC4D233B64EB0debounce.0aab18a9.js";import"./087AC4D233B64EB0hasIn.9f12b2a1.js";import"./087AC4D233B64EB0tree.2b9a65c6.js";import"./087AC4D233B64EB0index.bfb39b2a.js";import"./087AC4D233B64EB0authorityBtn.0890d580.js";import"./087AC4D233B64EB0api.db29bd05.js";import"./087AC4D233B64EB0warningBar.beb718a3.js";const N={class:"authority"},V={class:"gva-table-box"},x={class:"gva-btn-list"},z={class:"dialog-footer"},U=Object.assign({name:"Authority"},{__name:"authority",setup(U){const q=a([{authorityId:0,authorityName:"根角色"}]),F=a(!1),R=a("add"),S=a({}),O=a("新增角色"),P=a(!1),T=a(!1),$=a({}),G=a({authorityId:0,authorityName:"",parentId:0}),H=a({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(a,e,t)=>/^[0-9]*[1-9][0-9]*$/.test(e)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),J=a(1),K=a(0),L=a(999),M=a([]),Q=a({}),W=async()=>{const a=await A({page:J.value,pageSize:L.value,...Q.value});0===a.code&&(M.value=a.data.list,K.value=a.data.total,J.value=a.data.page,L.value=a.data.pageSize)};W();const X=(a,e)=>{S.value[a]=e},Y=a(null),Z=a(null),aa=a(null),ea=(a,e)=>{const t=[Y,Z,aa];e&&t[e].value.needConfirm&&(t[e].value.enterAndNext(),t[e].value.needConfirm=!1)},ta=a(null),la=()=>{ta.value&&ta.value.resetFields(),G.value={authorityId:0,authorityName:"",parentId:0}},oa=()=>{la(),P.value=!1,T.value=!1},ra=()=>{ta.value.validate((async a=>{if(a){switch(G.value.authorityId=Number(G.value.authorityId),R.value){case"add":0===(await j(G.value)).code&&(n({type:"success",message:"添加成功!"}),W(),oa());break;case"edit":0===(await D(G.value)).code&&(n({type:"success",message:"添加成功!"}),W(),oa());break;case"copy":{const a={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};a.authority.authorityId=G.value.authorityId,a.authority.authorityName=G.value.authorityName,a.authority.parentId=G.value.parentId,a.authority.dataAuthorityId=$.value.dataAuthorityId,a.oldAuthorityId=$.value.authorityId;0===(await g(a)).code&&(n({type:"success",message:"复制成功！"}),W())}}la(),P.value=!1}}))},ia=()=>{q.value=[{authorityId:0,authorityName:"根角色"}],ua(M.value,q.value,!1)},ua=(a,e,t)=>{a&&a.forEach((a=>{if(a.children&&a.children.length){const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===G.value.authorityId,children:[]};ua(a.children,l.children,t||a.authorityId===G.value.authorityId),e.push(l)}else{const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===G.value.authorityId};e.push(l)}}))},sa=a=>{la(),O.value="新增角色",R.value="add",G.value.parentId=a,ia(),P.value=!0};return(a,A)=>{const g=m,D=I,j=E,U=C,T=B,K=p,L=f,Q=c,la=h,ua=v,da=y;return e(),t("div",N,[l("div",V,[l("div",x,[o(g,{type:"primary",icon:"plus",size:"small",onClick:A[0]||(A[0]=a=>sa(0))},{default:r((()=>[i("新增角色")])),_:1})]),o(j,{data:M.value,"tree-props":{children:"children",hasChildren:"hasChildren"},size:"small",stripe:!0,"row-key":"authorityId",style:{width:"100%"}},{default:r((()=>[o(D,{label:"角色ID","min-width":"180",prop:"authorityId"}),o(D,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),o(D,{align:"left",label:"操作",width:"460"},{default:r((a=>[o(g,{icon:"setting",size:"small",type:"primary",link:"",onClick:e=>{return t=a.row,F.value=!0,void(S.value=t);var t}},{default:r((()=>[i("设置权限")])),_:2},1032,["onClick"]),o(g,{icon:"plus",size:"small",type:"primary",link:"",onClick:e=>sa(a.row.authorityId)},{default:r((()=>[i("新增子角色")])),_:2},1032,["onClick"]),o(g,{icon:"copy-document",size:"small",type:"primary",link:"",onClick:e=>(a=>{ia(),O.value="拷贝角色",R.value="copy";for(const e in G.value)G.value[e]=a[e];$.value=a,P.value=!0})(a.row)},{default:r((()=>[i("拷贝")])),_:2},1032,["onClick"]),o(g,{icon:"edit",size:"small",type:"primary",link:"",onClick:e=>(a=>{ia(),O.value="编辑角色",R.value="edit";for(const e in G.value)G.value[e]=a[e];ia(),P.value=!0})(a.row)},{default:r((()=>[i("编辑")])),_:2},1032,["onClick"]),o(g,{icon:"delete",size:"small",type:"primary",link:"",onClick:e=>{return t=a.row,void d.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await b({authorityId:t.authorityId})).code&&(n({type:"success",message:"删除成功!"}),1===M.value.length&&J.value>1&&J.value--,W())})).catch((()=>{n({type:"info",message:"已取消删除"})}));var t}},{default:r((()=>[i("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),o(Q,{modelValue:P.value,"onUpdate:modelValue":A[4]||(A[4]=a=>P.value=a),title:O.value},{footer:r((()=>[l("div",z,[o(g,{size:"small",onClick:oa},{default:r((()=>[i("取 消")])),_:1}),o(g,{size:"small",type:"primary",onClick:ra},{default:r((()=>[i("确 定")])),_:1})])])),default:r((()=>[o(L,{ref_key:"authorityForm",ref:ta,model:G.value,rules:H.value,"label-width":"80px"},{default:r((()=>[o(T,{label:"父级角色",prop:"parentId"},{default:r((()=>[o(U,{modelValue:G.value.parentId,"onUpdate:modelValue":A[1]||(A[1]=a=>G.value.parentId=a),style:{width:"100%"},disabled:"add"===R.value,options:q.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),o(T,{label:"角色ID",prop:"authorityId"},{default:r((()=>[o(K,{modelValue:G.value.authorityId,"onUpdate:modelValue":A[2]||(A[2]=a=>G.value.authorityId=a),disabled:"edit"===R.value,autocomplete:"off",maxlength:"15"},null,8,["modelValue","disabled"])])),_:1}),o(T,{label:"角色姓名",prop:"authorityName"},{default:r((()=>[o(K,{modelValue:G.value.authorityName,"onUpdate:modelValue":A[3]||(A[3]=a=>G.value.authorityName=a),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),F.value?(e(),u(da,{key:0,modelValue:F.value,"onUpdate:modelValue":A[5]||(A[5]=a=>F.value=a),"with-header":!1,size:"40%",title:"角色配置"},{default:r((()=>[o(ua,{"before-leave":ea,type:"border-card"},{default:r((()=>[o(la,{label:"角色菜单"},{default:r((()=>[o(w,{ref_key:"menus",ref:Y,row:S.value,onChangeRow:X},null,8,["row"])])),_:1}),o(la,{label:"角色api"},{default:r((()=>[o(k,{ref_key:"apis",ref:Z,row:S.value,onChangeRow:X},null,8,["row"])])),_:1}),o(la,{label:"资源权限"},{default:r((()=>[o(_,{ref_key:"datas",ref:aa,authority:M.value,row:S.value,onChangeRow:X},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):s("",!0)])}}});export{U as default};
